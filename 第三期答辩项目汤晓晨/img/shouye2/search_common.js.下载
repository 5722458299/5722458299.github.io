var timeOut;var mainView;var _SHOP_ID_=_SHOP_ID_||"";var searchTag=searchTag||false;$(function(){myApp=new Framework7();$(".search_info,.search_tankuang,.search_header").hide();$(document).keydown(function(g){var h=g.which;if(h==13&&$(".search_input").length>0){var f=$(".search_input").val().trim();if(_SHOP_ID_&&searchTag){doShopSearch(f,_SHOP_ID_)}else{dosearch(f)}}});$(".search_input").live("input propertychange",function(){var f=$(this);if(typeof timeOut=="undefined"){timeOut=0}clearTimeout(timeOut);timeOut=setTimeout(function(){associateSearch(f)},300)});mainView=myApp.addView(".views");var e,a,c,b,d;$(".open-search").focus(function(){if($(".views").attr("data-page")!="search"){showSearchPage()}});$(".open-popup").live("click",function(){if($(".views").attr("data-page")!="search"){showSearchPage();if($(".goods_extend_tabs")){$(".goods_extend_tabs").hide()}}});$(".head_close-popup").live("click",function(){hideSearchPage();if($(".goods_extend_tabs")){$(".goods_extend_tabs").show()}})});function showSearchPage(){searchTag=false;$("#navbar-container").hide();$(".sales_fixed ,.cbbfixed").hide();$(".nav_bg").css("background","#f7f7f8");lefthtml=$(".left").html();righthtml=$(".right").html();middleHtml=$(".center").html();$(".left").addClass("search_left");$(".right").addClass("search_right");$(".center").addClass("search_center");seachInputLength=$(".center .search_input").length;if(seachInputLength==0){$(".center").html('<div class="search_bg"></div><div class="search_img"></div><input type="text" maxlength="30" class="search_input" placeholder="请输入搜索商品">');$(".center").addClass("search_center")}$(".left").html('<a class="head_close-popup"><i class="head_close"></i></a>');$(".right").html("<div class='searchbtn'><span>搜索</span></div>").show();$(".common_top").hide();$(".common_top li").removeClass("on");$(".common_top li").eq(2).addClass("on");$(".page").css("top","0px");$(".toolbar").hide();mainView.router.loadContent($("#mySearch").html());postAjaxRequest("/search/hothistory.do",null,historyCallback,errorCallback);backgroundCss=$(".page-content:first").css("background");$(".page-content:eq(1)").css("background","#fff");$(".page-content:eq(0)").css("padding-bottom","0px");if(typeof(searchPageCallBack)=="function"){searchPageCallBack()}if(typeof(hideRelevantDom)=="function"){hideRelevantDom()}}function hideSearchPage(){$("#navbar-container").show();$(".search_input").val("");$(".left").removeClass("search_left");$(".right").removeClass("search_right");$(".nav_bg").css("background","#fafafa");$(" .common_top li").removeClass("on");var a=document.location.pathname;mainView.router.back();$(".sales_fixed ,.cbbfixed").show();if(a==""||a=="/"||a=="/index.html"){if(__IS_WECHAT__==true||__IS_ALIPAY__==true){$(".navbar").css("background","none")}else{}}$(".left").html(lefthtml);$(".right").html(righthtml);if(seachInputLength==0){$(".center").html(middleHtml)}$(".common_top").hide();$(".toolbar").show();$(".page").css("top","0px");$(".page-content:first").css("background",backgroundCss);$(".page-content:eq(0)").css("padding-bottom","44px");if(typeof(searchPageCallBack)=="function"){searchPageCallBack()}if(typeof(showRelevantDom)=="function"){showRelevantDom()}}$(".search .swiper-wrapper .swiper-slide").live("click",function(){var a=$(this).find("span").html().trim();window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(a)});$(".search_keyword li,.search_history ul li").live("click",function(){if($(this).data("info")=="defaultkeyword"){window.location.href=$.cookie("dekurl")}else{var c=entityToString($(this).html());var b=$(this).data("linkid");var a=$(this).data("templatetype");if(a!=undefined&&a!=null&&a>0){switch(a){case 10:window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(b);break;case 20:window.location.href=__BASE_SERVER__+"/event/"+b+".html";break;case 30:window.location.href=__BASE_SERVER__+"/designevent/"+b+".html";break;case 40:window.location.href=b;break;case 80:window.location.href=__BASE_SERVER__+"/lvb/"+b+".html";break;case 81:window.location.href=__BASE_SERVER__+"/video/"+b+".html";break;case 82:window.location.href=__BASE_SERVER__+"/channel/list-"+b+"-20-2.html?catnm="+c;break;default:window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(c)}}else{window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(c)}}});$(".right .searchbtn span").live("click",function(){var a=$(".search_input").val().trim();dosearch(a)});function dosearch(h){if(VALIDATERULES.isNull(h)&&typeof(_KEY_URL_)!="undefined"&&!VALIDATERULES.isNull(_KEY_URL_.trim())){var d=__LINKTITLE__.replace("@","");var b=$.cookie("sh");if(typeof(b)!="undefined"||b==""){var e=false;var f=b.split("@");$.each(f,function(j,i){if(i===d+"defaultkeyword"){e=true}});if(!e){$.cookie("sh",d+"defaultkeyword@"+b,{path:"/",expires:1});$.cookie("dekurl",_KEY_URL_,{path:"/",expires:1})}}else{$.cookie("sh",d+"defaultkeyword",{path:"/",expires:1});$.cookie("dekurl",_KEY_URL_,{path:"/",expires:1})}window.location.href=_KEY_URL_;return}if(h){window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(h)}else{var a=$(".search_input").attr("placeholder");var c=$(".search_input").attr("data-type");var g=$(".search_input").attr("data-id");if(a!=null&&c!=null&&a!="请输入搜索商品"){switch(c){case"10":window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(g);break;case"20":window.location.href=__BASE_SERVER__+"/event/"+g+".html";break;case"30":window.location.href=__BASE_SERVER__+"/designevent/"+g+".html";break;case"40":window.location.href=g;break;case"80":window.location.href=__BASE_SERVER__+"/lvb/"+g+".html";break;case"81":window.location.href=__BASE_SERVER__+"/video/"+g+".html";break;case"82":window.location.href=__BASE_SERVER__+"/channel/list-"+g+"-20-2.html?catnm="+a;break;default:window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(a)}}else{if(a!="请输入搜索商品"){window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(a)}}}}function search_tankuang_show(){ConfirmBox.confirm("","确定要清空历史记录吗？",function(){postAjaxRequest("/search/clear.do",null,clearCallback,errorCallback)},"","确认","取消")}function historyCallback(d){if(d.state){var c="";$(".search").show();if(d.searchHistory.length>0){var b=d.searchHistory;$.each(b,function(e,f){if(f.indexOf("defaultkeyword")>0){c+='<li data-info="defaultkeyword">'+f.replace("defaultkeyword","")+"</li>"}else{c+="<li>"+f+"</li>"}});$(".search_history ul").html(c);$(".search_history").show()}else{$(".search_empty,.search_history,.white_bg").hide()}var a="";if(d.indexplace.length>0){var b=d.indexplace;$.each(b,function(e,f){if(f.templateType!=null&&f.templateType!=undefined&&f.templateType>0){a+=' <li data-value="'+f.linkTitle+'" data-templatetype="'+f.templateType+'" data-linkid="'+f.linkId+'">'+f.linkTitle+"</li>"}else{a+=' <li data-value="'+f.linkTitle+'">'+f.linkTitle+"</li>"}});$(".search_keyword ul").html(a);$(".search_hot,.search_keyword").show()}else{$(".search_hot,.search_keyword").hide()}if(!d.indexplace.length>0&&!d.searchHistory.length>0){$(".search").hide()}}$(".popup-search .search_input").focus();myApp.hidePreloader()}function errorCallback(){ConfirmBox.alert("网络问题")}function clearCallback(a){if(a.state){$(".search_history ul").html("");postAjaxRequest("/search/hothistory.do",null,historyCallback,errorCallback)}else{ConfirmBox.alert("清空失败")}}$(".sear_lx li").live("click",function(){var a=$(this).children(".sear_item").html();dosearch(a)});$("input[class='search_input']").focus(function(){var a=$(this).val();$(this).val("");$(this).val(a);if($(".views").attr("data-page")!="search"){if(_SHOP_ID_){showShopSearchPage()}else{showSearchPage()}}});function associateSearch(c){$(".sear_lx .lxwx_list").html("");var a=c.val().trim();var b={keyword:a};if(a!=""){$(".search_history,.search_empty").hide();$(".search_null div:not(.sear_lx)").hide();postAjaxRequest("/search/associateword.do",b,function(e){if(e.state){$(".sear_lx .lxwx_list").html("");if(e.associateWord.list.length>0){var d="";$.each(e.associateWord.list,function(f,g){if(g.text.trim()==a){d+='<li class="ontext"><div class="sear_item">'+g.text+'</div><div class="sear_count">约'+g.count+"个商品</div></li>"}else{d+='<li><div class="sear_item">'+g.text+'</div><div class="sear_count">约'+g.count+"个商品</div></li>"}});$(".sear_lx .lxwx_list").append(d)}}})}else{$(".sear_lx .lxwx_list").html("");$(".search div:not(.sear_lx)").show();$(".search_null div:not(.sear_lx)").show();if($(".search_history ul li").length==0){$(".search_history,.search_empty").hide()}}}function entityToString(a){var c=document.createElement("div");c.innerHTML=a;var b=c.innerText||c.textContent;console.log(a,"->",b);return b}function showShopSearchPage(){if(mainView.url=="#content-1"){return}searchTag=true;$("#navbar-container").hide();$(".sales_fixed ,.cbbfixed").hide();$(".nav_bg").css("background","#f7f7f8");lefthtml=$(".left").html();righthtml=$(".right").html();middleHtml=$(".center").html();$(".left").addClass("search_left");$(".right").addClass("search_right");$(".center").addClass("search_center");seachInputLength=$(".center .search_input").length;if(seachInputLength==0){$(".center").html('<div class="search_bg"></div><div class="search_img"></div><input type="text" maxlength="30" class="shop_search_input" placeholder="请输入搜索商品">');$(".center").addClass("search_center")}$(".left").html('<a class="head_close-popup"><i class="head_close"></i></a>');$(".right").html("<div class='shopSearchbtn'><span>搜索</span></div>").show();$(".common_top").hide();$(".common_top li").removeClass("on");$(".common_top li").eq(2).addClass("on");$(".page").css("top","0px");$(".toolbar").hide();mainView.router.loadContent($("#myShopSearch").html());postAjaxRequest("/search/hothistory.do",null,historyCallback,errorCallback);backgroundCss=$(".page-content:first").css("background");$(".page-content:eq(1)").css("background","#fff");$(".page-content:eq(0)").css("padding-bottom","0px");if(typeof(searchPageCallBack)=="function"){searchPageCallBack()}if(typeof(hideRelevantDom)=="function"){hideRelevantDom()}}function doShopSearch(b,a){if(b){window.location.href=__BASE_SERVER__+"/search-AUTO-DESC.html?keyword="+encodeURIComponent(b)+"&shopid="+a}};